<!-- admin/index.html -->
<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>

    <!-- Include the styles for the Netlify CMS UI, after your own styles -->
    <link rel="stylesheet" href="https://unpkg.com/netlify-cms@^1.0.0/dist/cms.css" />

</head>
<body>
    <!-- Include the script that builds the page and powers Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^1.0.0/dist/cms.js"></script>
    <script>
//initialisation variable

var completeDrawing = document.createElement("completeDrawingLayer");
var isPainting = false;
    var layerNo = 0;

var canvasList = [];

    var shapeCanvasList = [];
    var textCanvasList = [];
    
    var userStrokeStyle = '#FFC0CB';
    var line = [];
    var prevPos = { offsetX: 0, offsetY: 0 };

 var   rect = {};
   var paint = false;
var clickX = new Array();
        var clickY = new Array();
        var clickDrag = new Array();


function hello()
{
alert('hello');
}

function addClick(x, y, dragging)
        {
            clickX.push(x);
            clickY.push(y);
            clickDrag.push(dragging);
        }

function redraw(){
var canvas = document.getElementById('completeDrawingLayer');
 var   ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clears the canvas
             
            ctx.strokeStyle = "#333";
            ctx.lineJoin = "round";
            ctx.lineWidth = 8;
             
            for(var i=0; i < clickX.length; i++) {       
                ctx.beginPath();
                if(clickDrag[i] && i){
                    ctx.moveTo(clickX[i-1], clickY[i-1]);
                }else{
                    ctx.moveTo(clickX[i]-1, clickY[i]);
                }
                ctx.lineTo(clickX[i], clickY[i]);
                ctx.closePath();
                ctx.stroke();
            }
        }

function draw() {

var canvas = document.getElementById('completeDrawingLayer');
 var   ctx = canvas.getContext('2d');
alert('je suis en train de dessiner');
  

}

function exportt()
{
//export complete drawing
        var completeDrawing = document.getElementById("completeDrawingLayer")
        var image = completeDrawing.toDataURL("image/png").replace("image/png", "image/octet-stream");

        //new element a which is a link (href) to the image : permits download
        var link = document.createElement('a');
        link.download = "image.png";
        link.href = image;
        link.click();
}
function erase() 
    {
        //clear the complete drawing canvas
        var canvas = document.getElementById('completeDrawingLayer');
 var   ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        clickX = [];
	clickY = [];
	clickDrag = [];

        //clear the single stroke canvas
        
        
        this.layerNo = 0;
        this.canvasList = [];
        this.shapeCanvasList = [];
        this.textCanvasList = [];
    }

function mouseDown(e) {
//alert('je suis en mouseDown');
var canvas = document.getElementById('completeDrawingLayer');
 var   ctx = canvas.getContext('2d');	
  var mouseX = e.pageX - canvas.offsetLeft;
            var mouseY = e.pageY - canvas.offsetTop;
             
            paint = true;
            addClick(e.pageX - canvas.offsetLeft, e.pageY - canvas.offsetTop);
            redraw();

}

function mouseUp() {
//alert('je suis en MouseUp');
  paint = false;
}

function mouseLeave() {
//alert('je suis en MouseLeave');
  paint = false;
}

function mouseMove(e) {
//alert('je suis en mouseMove');
var canvas = document.getElementById('completeDrawingLayer');
 var   ctx = canvas.getContext('2d');
//alert(paint);
  if(paint){
                addClick(e.pageX - canvas.offsetLeft, e.pageY - canvas.offsetTop, true);
                redraw();
            }
}

function init() {
  var canvas = document.getElementById('completeDrawingLayer');
  var   ctx = canvas.getContext('2d');
  canvas.addEventListener('mousedown', mouseDown, false);
  canvas.addEventListener('mouseup', mouseUp, false);
  canvas.addEventListener('mousemove', mouseMove, false); 
  canvas.addEventListener('mouseleave', mouseLeave, false);
}


var CanvasControl = createClass({

  render: function() {
    return h('div', {},
 	 h('script',{src: 'hfiuhiuhiuhiu'}, 'Export'),
      h('button',{onClick : ()=> exportt()}, 'Export'),
      h('button',{onClick : ()=> erase()}, 'Clear all'),
      h('br'),
      h('canvas',{id: 'completeDrawingLayer', style :{'background': '#E4F4FB'},height:'500',width:'500', onClick : ()=>init()},'canv'),
      h('br'),
      h('canvas',{id: 'singleStrokeLayer', style :{'background': '#C0C0C0'}, height:'40',width:'200'},'canv'),
h('button',{onClick: ()=> init()},'Start Drawing'));

//dans la division on met 2 buttons, un canvas ...
  }
});
CMS.registerWidget('canvasWidget', CanvasControl);
//to Block ne pas mettr  le stream HTML, on met ce q'on veut persister
//ecrire le contenu du fichier JSON
//to Preview done le JSON  a canvas goJS uqi se debrouille pour faire le rendering 
//dans quelle methode est le code du browsing? 

CMS.registerEditorComponent({
  // Internal id of the component
  id: "canvas",
  // Visible label
  label: "Canvas",
  // Fields the user need to fill out when adding an instance of the component
  fields: [{name: 'id', label: 'Canvas ID', widget: 'canvasWidget'}],
  // Pattern to identify a block as being an instance of this component
  pattern: /^{{< youtube (\S+) >}}$/,
  // Function to extract data elements from the regexp match
  fromBlock: function(match) {
    return {
      id: match[1]
    };
  },
  // Function to create a text block from an instance of this component
  toBlock: function(obj) {
    return `{{< Canvas ${obj.id} >}}`;
  },
  // Preview output for this component. Can either be a string or a React component
  // (component gives better render performance)
  toPreview: function(obj) {
    return (
      `<img src="https://img.youtube.com/vi/${obj.id}/maxresdefault.jpg" alt="Youtube Video"/>`
    );
  }
});

    </script>
</body>
</html>
